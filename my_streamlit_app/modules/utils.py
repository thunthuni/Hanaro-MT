import pandas as pd
from dotenv import load_dotenv
import os
load_dotenv()
SERPAPI_KEY = os.getenv("SERPAPI_KEY")

import streamlit as st

import requests
from bs4 import BeautifulSoup

from serpapi import GoogleSearch



@st.cache_data
def load_data(path="data/df_.xlsx"):
    base_dir = os.path.dirname(os.path.abspath(__file__))
    full_path = os.path.join(base_dir, "..", path)
    df = pd.read_excel(full_path, index_col=0)
    return df


def get_products_df(df):
    df["ìƒí’ˆë³„í•´ì§€ìœ¨[%]"] = round(df['ìƒí’ˆë³„í•´ì§€ìœ¨'] * 100, 2)
    return df[['ìƒí’ˆì½”ë“œ', "ìƒí’ˆëª…", "ìƒí’ˆêµ¬ë¶„", "ìƒí’ˆë³„í•´ì§€ìœ¨[%]", "ì€í–‰ì½”ë“œ", "ì€í–‰ëª…"]].drop_duplicates().sort_values(by='ìƒí’ˆë³„í•´ì§€ìœ¨[%]', ascending=False)



def get_bank_df(df):
    bank_cols = ['ì€í–‰ì½”ë“œ',	'ì€í–‰ëª…',	'ìƒí’ˆì½”ë“œ',	'ìƒí’ˆëª…',	'ìƒí’ˆì¼ë ¨ë²ˆí˜¸',	'ê³„ì•½ê¸°ê°„ê°œì›”ìˆ˜_ìµœì†Œêµ¬ê°„',	'ê³„ì•½ê¸°ê°„ê°œì›”ìˆ˜_ìµœëŒ€êµ¬ê°„',	'ê°€ì…ê¸ˆì•¡_ìµœì†Œêµ¬ê°„',	'ê°€ì…ê¸ˆì•¡_ìµœëŒ€êµ¬ê°„',
                'í†µì¥ê±°ì¹˜ì‹_ì‹ ê·œê°€ì…ê¸ˆì•¡_ë‹¨ìœ„',	'ì ë¦½ì‹_ì›”ë¶€ê¸ˆ_ë‹¨ìœ„',	'ìƒí’ˆê°œìš”_ì„¤ëª…',	'ì‹ ê·œì±„ë„',	'í•´ì§€ì±„ë„',	'ìƒí’ˆê·¸ë£¹ì½”ë“œ',	'ìƒí’ˆê·¸ë£¹ëª…',	'ì˜ˆê¸ˆì…ì¶œê¸ˆë°©ì‹',	'ë§Œê¸°ì—¬ë¶€',	'ì´ìì§€ê¸‰ë°©ë²•',
                'ì´ìê³„ì‚°ë°©ë²•',	'ì ë¦½ì‹_ë¶€ê¸ˆë‚©ì…ë°©ì‹',	'ì ë¦½ì‹_ë¶€ê¸ˆë‚©ì…ì£¼ê¸°',	'ì ë¦½ì‹_ë¶€ê¸ˆê¸ˆì•¡í•œë„_ì—¬ë¶€',	'ì ë¦½ì‹_ë¶€ê¸ˆê¸ˆì•¡í•œë„_ì¡°ê±´',	'ê°€ì…ëŒ€ìƒê³ ê°_ì¡°ê±´ì—¬ë¶€',	'ê°€ì…ëŒ€ìƒê³ ê°_ì¡°ê±´',
                'ê°€ì…ì œí•œ_ì¡°ê±´ì—¬ë¶€',	'ê°€ì…ì œí•œ_ì¡°ê±´',	'ê¸°ë³¸ê¸ˆë¦¬',	'ì˜ˆê¸ˆìë³´í˜¸ëŒ€ìƒì—¬ë¶€',	'íŒë§¤í•œë„ê¸ˆì•¡',	'ë§Œê¸°í›„ì´ìœ¨',	'ì¤‘ë„í•´ì§€ì´ìœ¨',	'ì„¸ì œí˜œíƒ_ë¹„ê³¼ì„¸ì¢…í•©ì €ì¶•_ì—¬ë¶€',
                'ì„¸ì œí˜œíƒ_ë¹„ê³¼ì„¸ì¢…í•©ì €ì¶•_ì¡°ê±´',	'íšŒì „ì‹_ì •ê¸°ì˜ˆê¸ˆ_ì—¬ë¶€',	'íšŒì „ì‹_ì •ê¸°ì˜ˆê¸ˆ_íšŒì „ì£¼ê¸°_ê°œì›”ìˆ˜',	'ê¸°íƒ€_ìƒí’ˆê°€ì…_ê³ ë ¤ì‚¬í•­',	'ì¶”ê°€ë‚´ìš©',	'Deposit_Code',	'ìƒí’ˆêµ¬ë¶„',	'ìƒí’ˆêµ¬ë¶„ì¶œì²˜',
                'ê³„ì•½ê¸°ê°„ê°œì›”ìˆ˜_ìµœì†Œêµ¬ê°„_new',	'ê³„ì•½ê¸°ê°„ê°œì›”ìˆ˜_ìµœëŒ€êµ¬ê°„_new',	'ê°€ì…ê¸ˆì•¡_ìµœì†Œêµ¬ê°„_new',	'ê°€ì…ê¸ˆì•¡_ìµœëŒ€êµ¬ê°„_new',	'ì‹ ê·œì±„ë„_ëª¨ë°”ì¼ì›¹ë±…í‚¹',	'ì‹ ê·œì±„ë„_ìŠ¤ë§ˆíŠ¸ë±…í‚¹',	
                'ì‹ ê·œì±„ë„_ì˜ì—…ì ',	'ì‹ ê·œì±„ë„_ì¸í„°ë„·ë±…í‚¹',	'ì‹ ê·œì±„ë„_ì½œì„¼íƒ€',	'ì‹ ê·œì±„ë„_ê°œìˆ˜',	'í•´ì§€ì±„ë„_ê³„ì¢Œì´ì²´',	'í•´ì§€ì±„ë„_ëª¨ë°”ì¼ì›¹ë±…í‚¹',	'í•´ì§€ì±„ë„_ìŠ¤ë§ˆíŠ¸ë±…í‚¹',	'í•´ì§€ì±„ë„_ì˜ì—…ì ',
                    'í•´ì§€ì±„ë„_ì¸í„°ë„·ë±…í‚¹',	'í•´ì§€ì±„ë„_ì½œì„¼íƒ€',	'í•´ì§€ì±„ë„_ê°œìˆ˜',	'ê³ ì •ê³„ì•½ê¸°ê°„ì—¬ë¶€']
    return df[bank_cols].copy().drop_duplicates().reset_index(drop=True)

def get_prime_df(df):
    prime_cols = ['ì€í–‰ì½”ë“œ',	'ì€í–‰ëª…',	'ìƒí’ˆì½”ë“œ',	'ìƒí’ˆëª…',	'ìƒí’ˆì¼ë ¨ë²ˆí˜¸',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê°œìˆ˜',	'ìµœëŒ€ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°ì˜ˆê¸ˆì‹¤ì _ì—¬ë¶€',	
                  'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°ì˜ˆê¸ˆì‹¤ì _ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°ì˜ˆê¸ˆì‹¤ì _ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìš°ìˆ˜ê³ ê°ìš°ëŒ€ì œë„_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìš°ìˆ˜ê³ ê°ìš°ëŒ€ì œë„_ì¡°ê±´',	
                  'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìš°ìˆ˜ê³ ê°ìš°ëŒ€ì œë„_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê°€ì…ê¸ˆì•¡ìš°ëŒ€_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê°€ì…ê¸ˆì•¡ìš°ëŒ€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê°€ì…ê¸ˆì•¡ìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	
                  'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì•„íŒŒíŠ¸ê´€ë¦¬ë¹„ì´ì²´_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì•„íŒŒíŠ¸ê´€ë¦¬ë¹„ì´ì²´_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì•„íŒŒíŠ¸ê´€ë¦¬ë¹„ì´ì²´_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³µê³¼ê¸ˆì´ì²´_ì—¬ë¶€',	
                  'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³µê³¼ê¸ˆì´ì²´_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³µê³¼ê¸ˆì´ì²´_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸‰ì—¬ì´ì²´_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸‰ì—¬ì´ì²´_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸‰ì—¬ì´ì²´_ìš°ëŒ€ê¸ˆë¦¬',	
                  'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì˜ˆê¸ˆìë™ì´ì²´_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì˜ˆê¸ˆìë™ì´ì²´_ì—¬ë¶€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì˜ˆê¸ˆìë™ì´ì²´_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë³´í—˜ë£Œìë™ì´ì²´_ì—¬ë¶€',	
                  'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë³´í—˜ë£Œìë™ì´ì²´_ì—¬ë¶€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë³´í—˜ë£Œìë™ì´ì²´_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì—°ê¸ˆìë™ì´ì²´_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì—°ê¸ˆìë™ì´ì²´_ì—¬ë¶€_ì¡°ê±´',	
                  'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì—°ê¸ˆìë™ì´ì²´_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œê°€ë§¹ì ê²°ì œê³„ì¢Œ_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œê°€ë§¹ì ê²°ì œê³„ì¢Œ_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œê°€ë§¹ì ê²°ì œê³„ì¢Œ_ìš°ëŒ€ê¸ˆë¦¬',
                  'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œê²°ì œê³„ì¢Œ_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œê²°ì œê³„ì¢Œ_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œê²°ì œê³„ì¢Œ_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œì‚¬ìš©ê¸ˆì•¡_ì—¬ë¶€',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œì‚¬ìš©ê¸ˆì•¡_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì‹ ìš©ì¹´ë“œì‚¬ìš©ê¸ˆì•¡_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì²´í¬ì¹´ë“œì—°ê³„_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì²´í¬ì¹´ë“œì—°ê³„_ì¡°ê±´',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì²´í¬ì¹´ë“œì—°ê³„_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì œíœ´ì¹´ë“œì—°ê³„_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì œíœ´ì¹´ë“œì—°ê³„_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì œíœ´ì¹´ë“œì—°ê³„_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¬ìœ ì¹˜_ì—¬ë¶€',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¬ìœ ì¹˜_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¬ìœ ì¹˜_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¹´ë“œì‚¬ìš©ì‹¤ì _ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¹´ë“œì‚¬ìš©ì‹¤ì _ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¹´ë“œì‚¬ìš©ì‹¤ì _ìš°ëŒ€ê¸ˆë¦¬',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_í‡´ì§ê¸ˆì˜ˆì¹˜_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_í‡´ì§ê¸ˆì˜ˆì¹˜_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_í‡´ì§ê¸ˆì˜ˆì¹˜_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°íŠ¹ì„±ìš°ëŒ€_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°íŠ¹ì„±ìš°ëŒ€_ì¡°ê±´',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°íŠ¹ì„±ìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¥ë³‘ìš°ëŒ€_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¥ë³‘ìš°ëŒ€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¥ë³‘ìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë†ì–´ë¯¼ìš°ëŒ€_ì—¬ë¶€',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë†ì–´ë¯¼ìš°ëŒ€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë†ì–´ë¯¼ìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì–´ë¦°ì´ìš°ëŒ€_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì–´ë¦°ì´ìš°ëŒ€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì–´ë¦°ì´ìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_í•™ìƒìš°ëŒ€_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_í•™ìƒìš°ëŒ€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_í•™ìƒìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì²«ê±°ë˜ìš°ëŒ€_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì²«ê±°ë˜ìš°ëŒ€_ì¡°ê±´',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì²«ê±°ë˜ìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°ì—°ë ¹ìš°ëŒ€_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°ì—°ë ¹ìš°ëŒ€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê³ ê°ì—°ë ¹ìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë¹„ëŒ€ë©´ì±„ë„_ì—¬ë¶€',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë¹„ëŒ€ë©´ì±„ë„_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë¹„ëŒ€ë©´ì±„ë„_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¸í„°ë„·ë±…í‚¹_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¸í„°ë„·ë±…í‚¹_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì¸í„°ë„·ë±…í‚¹_ìš°ëŒ€ê¸ˆë¦¬',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ëª¨ë°”ì¼ë±…í‚¹_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ëª¨ë°”ì¼ë±…í‚¹_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ëª¨ë°”ì¼ë±…í‚¹_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ëª¨ë°”ì¼ì•±_ì—¬ë¶€', 'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ëª¨ë°”ì¼ì•±_ì¡°ê±´',	
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ëª¨ë°”ì¼ì•±_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì˜¤í”ˆë±…í‚¹_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì˜¤í”ˆë±…í‚¹_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ì˜¤í”ˆë±…í‚¹_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§ˆì´ë°ì´í„°_ì—¬ë¶€',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§ˆì´ë°ì´í„°_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§ˆì´ë°ì´í„°_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìƒí’ˆë¯¸ë³´ìœ _ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìƒí’ˆë¯¸ë³´ìœ _ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìƒí’ˆë¯¸ë³´ìœ _ìš°ëŒ€ê¸ˆë¦¬',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§Œê¸°ê¸ˆì•¡ìš°ëŒ€_ì—¬ë¶€', 'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§Œê¸°ê¸ˆì•¡ìš°ëŒ€_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§Œê¸°ê¸ˆì•¡ìš°ëŒ€_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§ˆì¼€íŒ…í™œìš©ë™ì˜_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§ˆì¼€íŒ…í™œìš©ë™ì˜_ì¡°ê±´',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ë§ˆì¼€íŒ…í™œìš©ë™ì˜_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìœ„ì¹˜ì¸ì¦_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìœ„ì¹˜ì¸ì¦_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ìœ„ì¹˜ì¸ì¦_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€1_ì—¬ë¶€',	
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€1_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€1_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€2_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€2_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€2_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€3_ì—¬ë¶€',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€3_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€3_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€4_ì—¬ë¶€',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€4_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€4_ìš°ëŒ€ê¸ˆë¦¬',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€5_ì—¬ë¶€',
                    'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€5_ì¡°ê±´',	'ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€5_ìš°ëŒ€ê¸ˆë¦¬',	'Deposit_Code']
    return df[prime_cols].copy().drop_duplicates().reset_index(drop=True)

def get_prime_count(df):
    # input_dfëŠ” prime_dfì´ì—¬ì•¼í•¨. (using `get_prime_df()`)
    
    prime_conditions = [item for item in df.columns if (item.startswith("ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_") and item.endswith("_ì—¬ë¶€"))]
    sorted_prime_cnt = df.pivot_table(index="ìƒí’ˆì½”ë“œ", values=prime_conditions).sum().sort_values(ascending=False)
    etc = ['ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€1_ì—¬ë¶€','ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€2_ì—¬ë¶€','ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€3_ì—¬ë¶€','ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€4_ì—¬ë¶€','ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€5_ì—¬ë¶€']
    etc_sum = sorted_prime_cnt[etc].sum()
    sorted_prime_cnt.drop(etc, inplace=True)
    sorted_prime_cnt["ìš°ëŒ€ê¸ˆë¦¬ì¡°ê±´_ê¸°íƒ€_ì—¬ë¶€"] = etc_sum # ê¸°íƒ€ 1-5ëŠ” ë§¨ ë§ˆì§€ë§‰ì— í•˜ë‚˜ë¡œ í†µí•©

    return sorted_prime_cnt


"""


"""


"""
df.drop(columns=["Acc_ID", "Contract_Date", "New_trsc_Amt", "Gender", "Age", "Job",	"Family", "Cancellation", "Card", 'Overdue', 
                            'Unsubscribe', 'Telecom', 'Marketing', 'ì—°ë ¹ëŒ€', 'Cancellation_bin']).drop_duplicates()
"""


def crawling_news():
    url = 'https://news.naver.com/breakingnews/section/101/259'
    res = requests.get(url)
    soup = BeautifulSoup(res.text, 'html.parser')

    # ë‰´ìŠ¤ ë§í¬ì™€ ì œëª© 20ê°œ ê°€ì ¸ì˜¤ê¸°
    news_list = soup.select('div.sa_text > a')[:20]

    results = []
    for item in news_list:
        title = item.text.strip()
        raw_link = item['href']
        
        # ë§í¬ ì •ì œ: ì¤‘ë³µëœ prefix ì œê±°
        if raw_link.startswith("https://news.naver.comhttps://"):
            link = raw_link.replace("https://news.naver.com", "")
        elif raw_link.startswith("/mnews"):
            link = "https://news.naver.com" + raw_link
        else:
            link = raw_link
        
        results.append([title, link])

    return results

        

from datetime import datetime



def fetch_google_related_queries(keyword):

    params = {
        "q": keyword,
        "engine": "google_trends",
        "data_type": "RELATED_QUERIES",
        "api_key": SERPAPI_KEY, 
    }

    search = GoogleSearch(params)
    results = search.get_dict()

    try:
        rising = results["related_queries"]["rising"]
        queries = [item["query"] for item in rising]
        return queries[:10]  
    except KeyError:
        return []
    

def fetch_google_trends_graph(keyword):
    params = {
        "q": keyword,
        "api_key": SERPAPI_KEY, 
        "engine": "google_trends"
    }

    search = GoogleSearch(params)
    results = search.get_dict()

    try:
        timeline = results["interest_over_time"]["timeline_data"]
        trend_data = []

        for entry in timeline:
            timestamp = entry.get("timestamp")  # ìœ ë‹‰ìŠ¤ íƒ€ì„ìŠ¤íƒ¬í”„ (str)
            if timestamp is None:
                continue

            # ğŸ”§ timestampë¥¼ datetimeìœ¼ë¡œ ë³€í™˜
            parsed_date = datetime.utcfromtimestamp(int(timestamp))

            for item in entry.get("values", []):
                query = item.get("query")
                value = item.get("extracted_value")
                if query is not None and value is not None:
                    trend_data.append({
                        "date": parsed_date,
                        "query": query,
                        "value": value
                    })

        return trend_data

    except KeyError:
        return []